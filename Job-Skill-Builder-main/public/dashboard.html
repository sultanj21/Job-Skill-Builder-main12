<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Dashboard – Pathway</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body class="page dashboard-page">

<header class="top-bar top-bar--app">
    <div class="top-left">
        <div class="logo">Pathway</div>

        <!-- TOP NAV -->
        <nav class="top-nav">
            <a href="/dashboard" class="top-link active">Dashboard</a>
            <a href="/jobs" class="top-link">Jobs</a>
            <a href="/elevator" class="top-link">Elevator Coach</a>
            <a href="/scheduler" class="top-link">Scheduler</a>
            <a href="/resume" class="top-link">Resume AI</a>
            <a href="/skills" class="top-link">Skills Coach</a>
        </nav>
    </div>

    <div class="top-right">
        <div class="top-user">
            <div class="top-user-avatar">
                <span id="topAvatarInitials">U</span>
            </div>
            <div class="top-user-meta">
                <span id="topUserName" class="top-user-name">Your Name</span>
                <span id="topUserTitle" class="top-user-title">Occupation</span>
            </div>
        </div>
        <button class="btn-outline btn-small" id="logoutBtn">Logout</button>
    </div>
</header>

<!-- MAIN LAYOUT -->
<main class="dashboard-shell pro-layout">

    <!-- SIDE NAV -->
    <aside class="dashboard-sidebar">
        <div class="sidebar-profile">
            <div class="sidebar-avatar">
                <img id="sidebarProfileImg" alt="Profile" />
                <span id="sidebarInitials"></span>
            </div>
            <div class="sidebar-profile-text">
                <h2 id="sidebarName">Your Name</h2>
                <p id="sidebarEmail" class="muted small">email@example.com</p>
            </div>
        </div>

        <div class="sidebar-section">
            <p class="sidebar-label">Workspace</p>
            <nav class="sidebar-nav">
                <button class="sidebar-tab active" data-tab="overview">Overview</button>
                <button class="sidebar-tab" data-tab="personal">Personal Info</button>
                <button class="sidebar-tab" data-tab="resume">Resume</button>
                <button class="sidebar-tab" data-tab="photo">Profile Photo</button>
                <button class="sidebar-tab" data-tab="account">Account</button>
            </nav>
        </div>

        <div class="sidebar-section">
            <p class="sidebar-label">Quick actions</p>

            <div class="quick-actions">
                <button class="qa-btn" data-tab-jump="resume">Upload a resume</button>

                <a href="/resume" class="qa-btn qa-btn-link">Open resume reformatter</a>

                <!-- NEW SKILLS COACH QUICK LINK -->
                <a href="/skills" class="qa-btn qa-btn-link">Open skills coach</a>

                <button class="qa-btn" data-tab-jump="photo">Update profile photo</button>
                <button class="qa-btn" data-tab-jump="personal">Review personal info</button>

                <a href="/jobs" class="qa-btn qa-btn-link">Explore jobs</a>
                <a href="/elevator" class="qa-btn qa-btn-link">Practice elevator pitch</a>
                <a href="/scheduler" class="qa-btn qa-btn-link">Open scheduler</a>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <section class="dashboard-main">

        <!-- OVERVIEW -->
        <div class="tab-panel active" id="tab-overview">
            <div class="grid grid-2 gap">

                <div class="card">
                    <div class="card-header-row">
                        <div>
                            <h3>Welcome back</h3>
                            <p class="muted small">Your career hub — stay job-ready.</p>
                        </div>
                        <div class="badge badge-soft">Profile Strength</div>
                    </div>

                    <div class="profile-completion">
                        <div class="completion-header">
                            <span id="completionLabel">Profile completeness</span>
                            <span id="completionPercent">0%</span>
                        </div>

                        <div class="completion-bar">
                            <div class="completion-fill" id="completionFill"></div>
                        </div>

                        <p class="muted x-small" id="completionHint">
                            Fill out your details to reach 100%.
                        </p>
                    </div>
                </div>

                <div class="card stats-card">
                    <h3>Snapshot</h3>
                    <div class="stats-grid">
                        <div class="stat-pill">
                            <span class="stat-label">Applications</span>
                            <span class="stat-value">0</span>
                            <span class="stat-sub muted x-small">Coming soon</span>
                        </div>

                        <div class="stat-pill">
                            <span class="stat-label">Saved jobs</span>
                            <span class="stat-value">0</span>
                            <span class="stat-sub muted x-small">Use Jobs page</span>
                        </div>

                        <div class="stat-pill">
                            <span class="stat-label">Resume</span>
                            <span class="stat-value" id="statResume">Not uploaded</span>
                            <span class="stat-sub muted x-small">Upload in Resume tab</span>
                        </div>

                        <div class="stat-pill">
                            <span class="stat-label">Member since</span>
                            <span class="stat-value" id="statMemberSince">—</span>
                            <span class="stat-sub muted x-small">Account age</span>
                        </div>
                    </div>
                </div>

            </div>

            <div class="grid grid-2 gap">
                <div class="card">
                    <h3>Profile overview</h3>
                    <div class="detail-grid">
                        <div><strong>Full Name:</strong> <span id="ovFullname"></span></div>
                        <div><strong>Occupation:</strong> <span id="ovOccupation"></span></div>
                        <div><strong>College:</strong> <span id="ovCollege"></span></div>
                        <div><strong>Graduation Date:</strong> <span id="ovGradDate"></span></div>
                        <div><strong>Location:</strong> <span id="ovLocation"></span></div>
                        <div><strong>Birthday:</strong> <span id="ovBirthday"></span></div>
                    </div>
                </div>

                <div class="card">
                    <h3>Recent activity</h3>
                    <ul class="activity-list">
                        <li>
                            <span class="dot dot-green"></span>
                            <div>
                                <p class="activity-title">Logged in</p>
                                <p class="activity-meta muted x-small">Just now</p>
                            </div>
                        </li>

                        <li>
                            <span class="dot dot-blue"></span>
                            <div>
                                <p class="activity-title">Start Skills Coach</p>
                                <p class="activity-meta muted x-small">Practice coding daily</p>
                            </div>
                        </li>

                        <li>
                            <span class="dot dot-gray"></span>
                            <div>
                                <p class="activity-title">Keep profile updated</p>
                            </div>
                        </li>
                    </ul>
                </div>

            </div>
        </div>

        <!-- PERSONAL INFO -->
        <div class="tab-panel" id="tab-personal">
            <div class="card">
                <h3>Personal information</h3>

                <div class="detail-grid">
                    <div><strong>First Name:</strong> <span id="pFirst"></span></div>
                    <div><strong>Last Name:</strong> <span id="pLast"></span></div>
                    <div><strong>Full Name:</strong> <span id="pFull"></span></div>
                    <div><strong>Email:</strong> <span id="pEmail"></span></div>
                    <div><strong>Birthday:</strong> <span id="pBirthday"></span></div>
                    <div><strong>Occupation:</strong> <span id="pOccupation"></span></div>
                </div>
            </div>

            <div class="grid grid-2 gap">
                <div class="card">
                    <h3>Address</h3>
                    <div class="detail-grid">
                        <div><strong>Street:</strong> <span id="pStreet"></span></div>
                        <div><strong>City:</strong> <span id="pCity"></span></div>
                        <div><strong>State:</strong> <span id="pState"></span></div>
                        <div><strong>ZIP:</strong> <span id="pZip"></span></div>
                    </div>
                </div>

                <div class="card">
                    <h3>Education</h3>
                    <div class="detail-grid">
                        <div><strong>College:</strong> <span id="pCollege"></span></div>
                        <div><strong>Certificate:</strong> <span id="pCertificate"></span></div>
                        <div><strong>Graduation Date:</strong> <span id="pGradDate"></span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RESUME TAB -->
        <div class="tab-panel" id="tab-resume">

            <div class="card">
                <h3>Resume upload</h3>

                <form id="resumeForm" class="inline-form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label>Choose a file</label>
                        <input id="resumeFile" name="resume" type="file" accept=".pdf,.doc,.docx">
                    </div>

                    <button type="submit" class="btn-primary">Upload resume</button>
                </form>

                <div id="resumeStatus" class="muted small" style="margin-top:0.75rem;"></div>
            </div>

            <div class="card">
                <h3>Resume tips</h3>
                <ul class="tips-list">
                    <li>1–2 pages max</li>
                    <li>Clear headings</li>
                    <li>Use measurable results</li>
                    <li>Tailor to each job (use Resume AI tool)</li>
                </ul>
            </div>
        </div>

        <!-- PHOTO TAB -->
        <div class="tab-panel" id="tab-photo">
            <div class="card">
                <h3>Profile photo</h3>

                <div class="profile-photo-row">
                    <div class="profile-photo-preview">
                        <img id="profilePhotoPreview">
                    </div>

                    <div class="profile-photo-controls">
                        <form id="profilePicForm" class="inline-form" enctype="multipart/form-data">
                            <div class="form-group">
                                <label>Choose image</label>
                                <input id="profilePicInput" type="file" name="profilePic" accept="image/*">
                            </div>

                            <button class="btn-primary">Upload photo</button>
                        </form>

                        <div id="profilePicStatus" class="muted small" style="margin-top:0.75rem;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACCOUNT TAB -->
        <div class="tab-panel" id="tab-account">
            <div class="card">
                <h3>Account</h3>

                <div class="detail-grid">
                    <div><strong>Email:</strong> <span id="accEmail"></span></div>
                    <div><strong>Full Name:</strong> <span id="accFullname"></span></div>
                    <div><strong>Member Since:</strong> <span id="accCreatedAt"></span></div>
                </div>

                <button id="logoutBtn2" class="btn-outline" style="margin-top:1rem;">Logout</button>
            </div>
        </div>

    </section>

    <!-- RIGHT SIDE -->
    <aside class="dashboard-right">

        <div class="card">
            <h3>Your tools</h3>

            <ul class="tips-list small">
                <li>
                    <strong>Resume AI</strong><br />
                    Tailor your resume to any job posting.
                    <br />
                    <a href="/resume" class="link-inline small">Open Resume AI →</a>
                </li>

                <li>
                    <strong>Coding Skills Coach</strong><br />
                    Get project ideas and practice paths based on your goals.
                    <br />
                    <a href="/skills" class="link-inline small">Open Skills Coach →</a>
                </li>

                <li>
                    <strong>Elevator Coach</strong><br />
                    Practice your pitch with AI feedback.
                    <br />
                    <a href="/elevator" class="link-inline small">Open Elevator Coach →</a>
                </li>

                <li>
                    <strong>Scheduler</strong><br />
                    Create events and reminders.
                    <br />
                    <a href="/scheduler" class="link-inline small">Open Scheduler →</a>
                </li>
            </ul>
        </div>

        <div class="card">
            <h3>Career tips</h3>
            <ul class="tips-list">
                <li>Make your LinkedIn match your resume.</li>
                <li>Add class projects to your experience.</li>
                <li>Keep practicing technical problems weekly.</li>
            </ul>
        </div>

    </aside>

</main>

<script src="app.js"></script>

<script>
    /*
      Dashboard JS — loads user info + handles resume/photo uploads
      This matches the server.js provided earlier.
    */
    document.addEventListener("DOMContentLoaded", async () => {

        // Logout buttons
        document.getElementById("logoutBtn").onclick =
            document.getElementById("logoutBtn2").onclick =
                () => AppUtils.handleLogout();

        // Tab controls
        const tabButtons = document.querySelectorAll(".sidebar-tab");
        const tabPanels = document.querySelectorAll(".tab-panel");

        function showTab(tab) {
            tabButtons.forEach(b => b.classList.toggle("active", b.dataset.tab === tab));
            tabPanels.forEach(p => p.classList.toggle("active", p.id === "tab-" + tab));
        }

        tabButtons.forEach(btn => {
            btn.addEventListener("click", () => showTab(btn.dataset.tab));
        });

        document.querySelectorAll("[data-tab-jump]").forEach(btn => {
            btn.addEventListener("click", () => showTab(btn.dataset.tab));
        });

        // Load session user
        let user;
        try {
            const res = await fetch("/api/me");
            const data = await res.json();
            if (!data.success) return (window.location.href = "/login.html");
            user = data.user;
        } catch {
            return (window.location.href = "/login.html");
        }

        // Fill UI
        document.getElementById("topUserName").textContent = user.fullname;
        document.getElementById("topUserTitle").textContent = user.occupation;

        const initials =
            (user.firstname?.[0] || "U").toUpperCase() +
            (user.lastname?.[0] || "U").toUpperCase();

        document.getElementById("topAvatarInitials").textContent = initials;
        document.getElementById("sidebarInitials").textContent = initials;

        document.getElementById("sidebarName").textContent = user.fullname;
        document.getElementById("sidebarEmail").textContent = user.email;

        const pic = user.profilepicpath?.trim() || "https://via.placeholder.com/96?text=U";
        document.getElementById("sidebarProfileImg").src = pic;
        document.getElementById("profilePhotoPreview").src = pic;

        document.getElementById("ovFullname").textContent = user.fullname;
        document.getElementById("ovOccupation").textContent = user.occupation;
        document.getElementById("ovCollege").textContent = user.college;
        document.getElementById("ovGradDate").textContent = user.graddate;
        document.getElementById("ovLocation").textContent = [user.city, user.state].filter(Boolean).join(", ");
        document.getElementById("ovBirthday").textContent = user.birthday;

        const created = user.created_at ? new Date(user.created_at).toLocaleDateString() : "—";
        document.getElementById("statMemberSince").textContent = created;

        // Personal info
        document.getElementById("pFirst").textContent = user.firstname;
        document.getElementById("pLast").textContent = user.lastname;
        document.getElementById("pFull").textContent = user.fullname;
        document.getElementById("pEmail").textContent = user.email;
        document.getElementById("pBirthday").textContent = user.birthday;
        document.getElementById("pOccupation").textContent = user.occupation;
        document.getElementById("pStreet").textContent = user.street;
        document.getElementById("pCity").textContent = user.city;
        document.getElementById("pState").textContent = user.state;
        document.getElementById("pZip").textContent = user.zip;
        document.getElementById("pCollege").textContent = user.college;
        document.getElementById("pCertificate").textContent = user.certificate;
        document.getElementById("pGradDate").textContent = user.graddate;

        // Account tab
        document.getElementById("accEmail").textContent = user.email;
        document.getElementById("accFullname").textContent = user.fullname;
        document.getElementById("accCreatedAt").textContent = created;

        // Profile completion
        const fields = [
            user.firstname,
            user.lastname,
            user.birthday,
            user.email,
            user.occupation,
            user.city,
            user.state,
            user.college,
            user.certificate,
            user.graddate
        ];

        const filled = fields.filter(x => x && x.trim()).length;
        const percent = Math.min(100, Math.round((filled / fields.length) * 100));

        document.getElementById("completionFill").style.width = percent + "%";
        document.getElementById("completionPercent").textContent = percent + "%";

        // Resume upload
        const resumeForm = document.getElementById("resumeForm");
        const resumeStatus = document.getElementById("resumeStatus");

        resumeForm.addEventListener("submit", async e => {
            e.preventDefault();
            const file = document.getElementById("resumeFile").files[0];

            if (!file) return (resumeStatus.textContent = "Choose a file first.");

            const formData = new FormData();
            formData.append("resume", file);

            const res = await fetch("/upload-resume", { method: "POST", body: formData });
            const data = await res.json();

            resumeStatus.textContent = data.success
                ? "Uploaded: " + (data.filename || "file")
                : data.message;
        });

        // Profile picture upload
        const picForm = document.getElementById("profilePicForm");
        const picStatus = document.getElementById("profilePicStatus");

        picForm.addEventListener("submit", async e => {
            e.preventDefault();
            const file = document.getElementById("profilePicInput").files[0];
            if (!file) return (picStatus.textContent = "Choose an image first.");

            const formData = new FormData();
            formData.append("profilePic", file);

            const res = await fetch("/upload-profile-pic", { method: "POST", body: formData });
            const data = await res.json();

            picStatus.textContent = data.message;

            if (data.success && data.path) {
                document.getElementById("sidebarProfileImg").src = data.path;
                document.getElementById("profilePhotoPreview").src = data.path;
            }
        });

    });
</script>

</body>
</html>
