<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Login – Pathway</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body class="page auth-page">
<header class="top-bar">
    <div class="logo">Pathway</div>
    <nav>
        <a href="index.html">Home</a>
        <a href="register.html" class="btn-primary">Register</a>
    </nav>
</header>

<main class="auth-container">
    <div class="auth-card">
        <h2>Welcome back</h2>
        <p class="muted">Log in to access your dashboard and tools.</p>
        <form id="loginForm">
            <div class="form-group">
                <label for="email">Email<span class="required">*</span></label>
                <input id="email" name="email" type="email" required />
            </div>

            <div class="form-group">
                <label for="password">Password<span class="required">*</span></label>
                <div class="password-wrapper">
                    <input
                            id="password"
                            name="password"
                            type="password"
                            autocomplete="current-password"
                            required
                    />
                    <button type="button" id="togglePassword" class="password-toggle">
                        Show
                    </button>
                </div>
            </div>

            <button type="submit" class="btn-primary full-width">Log In</button>
        </form>
        <p class="muted small">
            Don't have an account? <a href="register.html">Create one</a>.
        </p>
    </div>
</main>

<script src="app.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        AppUtils.setupShowPassword("#togglePassword", "#password");

        const form = document.getElementById("loginForm");
        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const formData = new FormData(form);
            const payload = Object.fromEntries(formData.entries());

            try {
                const res = await fetch("/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload),
                });
                const data = await res.json();

                if (data.success) {
                    AppUtils.showBanner("Login successful. Redirecting…", "success");
                    window.location.href = "/dashboard";
                } else {
                    AppUtils.showBanner(data.message || "Login failed.", "error");
                }
            } catch (err) {
                console.error("Login error:", err);
                AppUtils.showBanner("Server error. Try again.", "error");
            }
        });
    });
</script>
</body>
</html>
